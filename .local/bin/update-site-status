#!/usr/bin/env bash

CACHE_DIR=${XDG_CACHE_HOME:-/home/julian/.cache}

update_site_status() {
  local site="$1"
  local output="$(curl -sL -w "%{http_code}\\n" "https://$site" -o /dev/null)"
  if [ ! $? -eq 0 ]; then
    echo "update-site-status failed for $site"
    exit 1
  fi

  mkdir -p "$CACHE_DIR/site-status"
  echo -n "$output" > "$CACHE_DIR/site-status/$site"
}

for site in "$@"; do
  update_site_status $site &
done

wait
