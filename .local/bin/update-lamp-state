#!/usr/bin/env bash

EMAIL=jandrews271@gmail.com
CACHE_DIR=${XDG_CACHE_HOME:-/home/julian/.cache}
JSON_FILE=/tmp/selenite-lamp.json

email_count=$(cat $CACHE_DIR/gmailcount/$EMAIL)
email_count=${email_count:-0}
hour=$(date +%H)
minute=$(date +%M)

if [ $hour -lt 8 ]; then
  json='{"pulse-hue":{"hue":52000,"period":10000,"wait":20000}}'
  message="Setting night mode"
elif [ $hour -eq 21 ] && [ $minute -gt 29 -a $minute -lt 46 ]; then
  json='{"pulse-hue":{"hue":10000,"period":2000,"wait":0}}'
  message="Setting catfood mode"
elif [ $email_count -gt 0 ]; then
  json='{"pulse-hue":{"hue":40000,"period":2000,"wait":0}}'
  message="Setting email alert"
elif [ $minute -eq 55 ]; then
  json='{"cycle-hues":{"period":500}}'
  message="Setting party mode!"
else
  json='{"gleam":{"frequency":0.002,"num_groups":4,"period":10000}}'
  message="Restoring default state"
fi

if ! cmp -s <(echo "$json") <$JSON_FILE; then
  echo "$json">$JSON_FILE
  echo "$message"
fi
