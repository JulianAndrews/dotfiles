#!/usr/bin/env sh

hostname=$(hostname)
displays=$(xrandr | grep 'connected' | cut -d ' ' -f 1)
connected_displays=$(xrandr | grep ' connected' | cut -d ' ' -f 1)

hasdisplay() {
  echo $connected_displays | grep -q $1
}

primary() {
  if [ "$hostname" = 'dean' ]
  then
    hasdisplay 'DP-2' && [ "$1" = 'DP-2' ] && echo -n ' --primary'
  elif [ "$hostname" = 'orpheus' ]
  then
    if hasdisplay 'HDMI1'
    then
      [ "$1" = 'HDMI1' ] && echo -n ' --primary'
    elif hasdisplay 'VGA1'
    then
      [ "$1" = 'VGA1' ] && echo -n ' --primary'
    fi
  fi
}

positioning() {
  if [ "$hostname" = 'dean' ]
  then
    [ "$1" = 'LVDS-1' ] && hasdisplay 'DP-2' && echo -n ' --right-of DP-2'
  elif [ "$hostname" = 'orpheus' ]
  then
    if hasdisplay 'HDMI1'
    then
      [ "$1" = 'VGA1' ] && echo -n ' --right-of HDMI1'
      [ "$1" = 'HDMI1' ] && hasdisplay 'eDP1' && echo -n ' --right-of eDP1'
    elif hasdisplay 'VGA1'
    then
      [ "$1" = 'VGA1' ] && hasdisplay 'eDP1' && echo -n ' --right-of eDP1'
    fi
  fi
}

rotation() {
  [ "$hostname" = 'orpheus' ] && [ "$1" = 'HDMI1' ] && echo -n ' --rotate left'
}

modifiers() {
  echo -n "$(primary $1)$(positioning $1)$(rotation $1)"
}

args=''
for display in $displays
do
  args="$args --output $display --auto$(modifiers $display)"
done

xrandr $args
