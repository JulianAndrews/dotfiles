" Autoinstall vim-plug if not installed
if empty(glob('~/.vim/autoload/plug.vim'))
  silent !curl -fLo ~/.vim/autoload/plug.vim --create-dirs
    \ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  autocmd VimEnter * PlugInstall | source $MYVIMRC
endif

call plug#begin('~/.vim/plugged')
Plug 'junegunn/fzf.vim'
Plug 'scrooloose/syntastic'
Plug 'Valloric/YouCompleteMe', { 'do': './install.py' }
Plug 'tpope/vim-fugitive'
Plug 'tpope/vim-commentary'
Plug 'altercation/vim-colors-solarized'
Plug 'hynek/vim-python-pep8-indent'

Plug 'ternjs/tern_for_vim'
Plug 'pangloss/vim-javascript'
Plug 'stephpy/vim-yaml'
Plug 'saltstack/salt-vim'
Plug 'glench/vim-jinja2-syntax'
call plug#end()

filetype plugin indent on
syntax on
set expandtab
set shiftwidth=2 tabstop=2 softtabstop=2
set number
set clipboard=unnamed
set backspace=2
set lazyredraw
set wildignore+=*.pyc
set mouse=a
set hlsearch
set cursorline
set wildmenu
set tags=tags
set completeopt=menu

set undofile
set undodir=~/.vim/undodir//

set t_Co=256
set background=dark
colorscheme solarized

function! VirtualenvName()
  let l:parts = split($VIRTUAL_ENV, "/")
  return len(l:parts) > 0 ? l:parts[-1] : ""
endfunction

" Status Line
set statusline=%<                                           "Truncation Point
set statusline+=%1*%h%r%w%m%*\                              "Flags
set statusline+=%f\                                         "File Name
set statusline+=%2*%y%*\                                    "File Type
set statusline+=%3*[%{fugitive#head()}]%*\                  "Git Branch
set statusline+=%4*[%{VirtualenvName()}]%*                  "Virtualenv
set statusline+=%=                                          "Right Align
set statusline+=%#warningmsg#%{SyntasticStatuslineFlag()}%* "Syntastic
set statusline+=%l:%c\                                      "Row and Column

set laststatus=2
hi StatusLine ctermbg=6 ctermfg=0
hi User1 ctermbg=0 ctermfg=1
hi User2 ctermbg=0 ctermfg=2
hi User3 ctermbg=0 ctermfg=5
hi User4 ctermbg=0 ctermfg=3

" Remap leader key to space
noremap <space> <nop>
let mapleader = "\<space>"

" Syntastic config
let g:syntastic_aggregate_errors = 1
let g:syntastic_always_populate_loc_list = 1
let g:syntastic_enable_signs = 0
let g:syntastic_python_checkers = ['python', 'pylint', 'flake8']
let g:syntastic_javascript_checkers = ['eslint']
let g:syntastic_haskell_checkers = ['hlint']
hi SyntasticError ctermbg=9 ctermfg=0

" Clear trailing whitespace in selected file types on save
autocmd BufWritePre *.py,*.js,*.hs,*.html,*.css,*.scss :%s/\s\+$//e

" fzf
set rtp+=~/.fzf
nnoremap <leader>f :Files<cr>
nnoremap <leader>F :GitFiles<cr>
nnoremap <leader>c :Commits<cr>
nnoremap <leader>r :History:<cr>

" YouCompleteMe
nnoremap <leader>j :YcmCompleter GoTo<cr>
nnoremap <leader>J :YcmCompleter GoToReferences<cr>

" Toggle syntax highlighting
nnoremap <silent> <leader>/ :noh<cr>

" Cycle through quickfix/location lists
fun! CycleList(nextcom, firstcom)
    try
        try
            execute a:nextcom
        catch /^Vim\%((\a\+)\)\=:E553/
            execute a:firstcom
        catch /^Vim\%((\a\+)\)\=:E776/
        endtry
    catch /^Vim\%((\a\+)\)\=:E42/
    endtry
endfun

nnoremap <silent> <F1> :call CycleList("lnext", "lfirst")<cr>
nnoremap <silent> <F2> :call CycleList("lprev", "llast")<cr>
nnoremap <silent> <F3> :call CycleList("cnext", "cfirst")<cr>
nnoremap <silent> <F4> :call CycleList("cprev", "clast")<cr>

" Paste from PRIMARY buffer
nnoremap <leader>p "+p
vnoremap <leader>p "+p
inoremap <S-Insert> <C-R>+

" Use htmldjango by default for html files
au BufNewFile,BufRead *.html set filetype=htmldjango
